<!doctype s-function-doc system "s-function-doc.dtd" [
<!entity % S-OLD "INCLUDE">
]
>

<!-- SCCS $Id: frailty.sgml,v 1.1 2003-05-08 09:14:16 therneau Exp $ -->
<s-function-doc>
<s-topics>
<s-topic> frailty </s-topic>
</s-topics>
<s-title>
Random effects terms
</s-title>
<s-description>
The frailty function allows one to add a simple random effects term to
a Cox or survreg model.
</s-description>
<s-usage>
<s-old-style-usage>
frailty(x, distribution="gamma", sparse, theta, df, method, eps)
</s-old-style-usage>
</s-usage>
<s-args-required>
<s-arg name=" x ">
the variable to be entered as a random effect.  
It is always treated as a factor.
</s-arg>
</s-args-required>

<s-args-optional>
<s-arg name=" distribution ">
either the <s-expression>gamma</s-expression>, 
<s-expression>gaussian</s-expression> or <s-expression>t</s-expression>
distribution may be specified.
The routines <s-expression>frailty.gamma</s-expression>,
<s-expression>frailty.gaussian</s-expression> and 
<s-expression>frailty.t</s-expression> do the actual work.
</s-arg>

<s-arg name=" sparse ">
cutoff for using a sparse coding of the data matrix.  
If the total number of levels of <s-expression>x</s-expression> is larger
than this value, then sparse coding is used.
The correct cutoff is still a matter of exploration: if the number of
levels is very large (thousands) then the non-sparse calculation may not be
feasable in terms of both memory and compute time.  
Likewise, the accuracy of the sparse approximation appears to be related to
the maximum proportion of subjects in any one class, being best when no
one class has a large membership.
</s-arg>

<s-arg name=" theta ">
if specified, this fixes the variance of the random effect.
If not, the variance is a parameter, and a best solution is sought.
Specifying this implies <s-expression>method='fixed'</s-expression>.
</s-arg>

<s-arg name=" df ">
if specified, this fixes the degrees of freedom for the random effect.
Specifying this implies <s-expression>method='df'</s-expression>.
Only one of <s-expression>theta</s-expression> or 
<s-expression>df</s-expression> should be specified.
</s-arg>

<s-arg name=" method ">
the method used to select a solution for theta, the variance of the
random effect.  
The <s-expression>fixed</s-expression> corresponds to a user-specified
value, and no iteration is done.
The <s-expression>df</s-expression> selects the variance such that the
degrees of freedom for the random effect matches a user specified value.
The <s-expression>aic</s-expression> method seeks to 
maximize Akiake's information criteria 
2*(partial likelihood - df).
The <s-expression>ml</s-expression> and <s-expression>reml</s-expression>
methods are specific to Cox models with gamma and gaussian random effects,
respectively.
Please see further discussion below.
</s-arg>

<s-arg name=" tdf ">
the degrees of freedom for the t-distribution.
</s-arg>

<s-arg name=" eps ">
convergence critera for the iteration on theta.
</s-arg>
</s-args-optional>

<s-value>
this function is used in the model statment of either
<s-expression>coxph</s-expression> or <s-expression>survreg</s-expression>.
It's results are used internally.
</s-value>

<s-details>
The <s-expression>frailty</s-expression> plugs into the general penalized
modeling framework provided by the <s-expression>coxph</s-expression> 
and <s-expression>survreg</s-expression> routines.  
This framework deals with likelihood, penalties, and degrees of freedom;
these aspects work well with either parent routine.
<br><br>
Therneau, Grambsch, and Pankratz show how maximum likelihood estimation for
the Cox model with a gamma frailty can be accomplished using a general
penalized routine, and Ripatti and Palmgren work through a similar argument
for the Cox model with a gaussian frailty.  Both of these are specific to
the Cox model.  
The first in particular has a flavor of `fooling' the penalized code into
doing the needed calculation.
Use of gamma/ml or gaussian/reml with 
<s-expression>survreg</s-expression> does not lead to valid results. 
<br><br>
The extensible structure of the penalized methods is such that the penalty
function, such as <s-expression>frailty</s-expression> or
<s-expression>pspine</s-expression>, is completely separate from the modeling
routine.  The strength of this is that a user can plug in any penalization
routine they choose.  A weakness is that it is very difficult for the
modeling routine to know whether a sensible penalty routine has been
supplied.  
</s-details>
<s-section name = "REFERENCES">
S Ripatti and J Palmgren, Estimation of multivariate frailty 
models using penalized partial likelihood,
Biometrics, 56:1016-1022, 2000.
<br>
T Therneau, P Grambsch and VS Pankratz,
Penalized survival models and frailty,
J Computational and Graphical Statistics, 12:156-175, 2003.
</s-section>
<s-see>
coxph, survreg
</s-see>
<s-examples>
<s-example>
# Random institutional effect
> coxph(Surv(time, status) ~ age + frailty(inst, df=4), lung)

                        coef se(coef)     se2 Chisq   DF     p 
                  age 0.0194 0.00933  0.00925 4.31  1.00 0.038
frailty(inst, df = 4)                         3.34  3.99 0.500

Iterations: 3 outer, 8 Newton-Raphson
     Variance of random effect= 0.0379   I-likelihood = -743.6 
Degrees of freedom for terms= 1 4 
Likelihood ratio test=9.96  on 4.97 df, p=0.075
  n=227 (1 observations deleted due to missing values)
</s-example>
</s-examples>
<s-keywords>
<s-keyword>
survival
</s-keyword>
</s-keywords>
<s-docclass>
function
</s-docclass>
</s-function-doc>
