<!doctype s-function-doc system "s-function-doc.dtd" [
<!entity % S-OLD "INCLUDE">
]
>
<!-- SCCS $Id: aareg.sgml,v 1.5 2004-11-04 08:12:52 therneau Exp $ -->
<s-function-doc>
<s-topics>
<s-topic> aareg </s-topic>
</s-topics>
<s-title>
Aalen's additive regression model for censored data
</s-title>
<s-description>
Returns an object of class <s-expression>"aareg"</s-expression> that
represents an Aalen model.
</s-description>
<s-usage>
<s-old-style-usage>
aareg(formula, data=&lt;&lt;see below&gt;&gt;,
weights=&lt;&lt;see below&gt;&gt;,  
    subset=&lt;&lt;see below&gt;&gt;, na.action, 
   qrtol=1e-07, nmin, dfbeta=F, taper=1,
   test = c('aalen', 'nrisk'),
    model=F, x=F, y=F) {
</s-old-style-usage>
</s-usage>
<s-args-required>

<s-arg name=" formula ">
a formula object, with the response on the left of a `~' operator and 
the terms,
 separated by <s-expression>+</s-expression> operators, on the right. 
The response must be a <s-expression>Surv</s-expression> object.
Due to a particular computational approach that is used, the model
MUST include an intercept term.  If "-1" is used in the model
formula the program will ignore it.
</s-arg>
</s-args-required>
<s-args-optional>

<s-arg name=" data ">
data frame in which to interpret the variables named in the
<s-expression>formula</s-expression>,
<s-expression>subset</s-expression>, and <s-expression>weights
</s-expression> arguments. This may also be a single number to handle
some speci al cases -- see below for details. If
<s-expression>data</s-expression> is missi ng, the variables in the
model formula should be in the search path.
</s-arg>

<s-arg name="weights">
vector of observation weights. If supplied, the fitting algorithm
minimizes the sum of the weights multiplied by the squared residuals
(see below for additional technical details). The length of
<s-expression>weights</s-expression> must be the same as the number of
observations. The weights must be nonnegative and it i s recommended
that they be strictly positive, since zero weights are ambiguous.  To
exclude particular observations from the model, use the
<s-expression>subset</s-expression> argument instead of zero weights.
</s-arg>

<s-arg name="subset">
expression specifying which subset of observations should be used in
the fit. Th is can be a logical vector (which is replicated to have
length equal to the numb er of observations), a numeric vector
indicating the observation numbers to be i ncluded, or a character
vector of the observation names that should be included.  All
observations are included by default.
</s-arg>

<s-arg name="na.action">
a function to filter missing data. This is applied to the
<s-expression>model.fr ame</s-expression> after any
<s-expression>subset</s-expression> argument has be en applied. The
default is <s-expression>na.fail</s-expression>, which returns a n
error if any missing values are found. An alternative is
<s-expression>na.excl ude</s-expression>, which deletes observations
that contain one or more missing values.
</s-arg>

<s-arg name=" qrtol ">
tolerance for detection of singularity in the QR decomposition
</s-arg>

<s-arg name=" nmin ">
minimum number of observations for an estimate; defaults to 3 times the
number of covariates.
This essentially truncates the computations near the tail of the data
set, when n is small and the calcualtions can become numerically
unstable.
</s-arg>

<s-arg name=" dfbeta ">
should the array of dfbeta residuals be computed.  This implies computation
of the sandwich variance estimate.
The residuals will always be computed if there is a
<s-expression>cluster</s-expression> term in the model formula.
</s-arg>

<s-arg name=" taper ">
allows for a smoothed variance estimate.
Var(x), where x is the set of covariates, is an important component of the
calculations for the Aalen regression model.  
At any given time point t, it is computed over all subjects who are still
at risk at time t.
The tape argument allows smoothing these estimates,
for example <s-expression>taper=(1:4)/4</s-expression> would cause
the variance estimate used at any event time to be a weighted average
of the estimated variance matrices at the last 4 death times,
with a weight of 1 for the current death time and decreasing to 1/4 for
prior event times.
The default value gives the standard Aalen model.

<s-arg name=" test ">
selects the weighting to be used, for computing an overall ``average''
coefficient vector over time and the subsequent test for equality to zero.
</s-arg>

<s-arg name=" model, x, y ">
should copies of the model frame, the x matrix of predictors, or the
response vector y be included in the saved result.
</s-arg>

</s-args-optional>

<s-value>
an object of class <s-expression>"aareg"</s-expression> 
representing the fit.
</s-value>

<s-details>
The Aalen model assumes that the cumulative hazard H(t) for a subject
can be expressed as a(t) + X B(t), where a(t) is a time-dependent intercept
term, X is the vector of covariates for the subject (possibly time-dependent),
and B(t) is a time-dependent matrix of coefficients.
The estimates are inheritly non-parametric; a fit of the model will normally
be followed by one or more plots of the estimates.
<br><br>
The estimates may become unstable near the tail of a data set, since the
increment to B at time t is based on the subjects still at risk at time
t.  The tolerance and/or nmin parameters may act to truncate the estimate
before the last death.
The <s-expression>taper</s-expression> argument can also be used to smooth
out the tail of the curve.
In practice, the addition of a taper such as 1:10 appears to have little
effect on death times when n is still reasonably large, but can considerably
dampen wild occilations in the tail of the plot.  

</s-details>
<s-section name = "REFERENCES">
Aalen, O.O. (1989). A linear regression model for the analysis of life times.
Statistics in Medicine, 8:907-925.

Aalen, O.O (1993). Further results on the non-parametric linear model in
survival analysis.  Statistics in Medicine. 12:1569-1588.
</s-section>
<s-see>
print.aareg, summary.aareg, plot.aareg
</s-see>
<s-examples>
<s-example>
# Fit a model to the lung cancer data set
> lfit <- aareg(Surv(time, status) ~ age + sex + ph.ecog, data=lung,
                     nmin=1)

> lfit
Call:
aareg(formula = Surv(time, status) ~ age + sex + ph.ecog, data = lung, nmin = 1
        )

  n=227 (1 observations deleted due to missing values)
    138 out of 138 unique event times used

              slope      coef se(coef)     z        p 
Intercept  5.26e-03  5.99e-03 4.74e-03  1.26 0.207000
      age  4.26e-05  7.02e-05 7.23e-05  0.97 0.332000
      sex -3.29e-03 -4.02e-03 1.22e-03 -3.30 0.000976
  ph.ecog  3.14e-03  3.80e-03 1.03e-03  3.70 0.000214

Chisq=26.73 on 3 df, p=6.7e-06; test weights=aalen

> plot(lfit[4], ylim=c(-4,4))  # Draw a plot of the function for ph.ecog

> lfit2 <- aareg(Surv(time, status) ~ age + sex + ph.ecog, data=lung,
                  nmin=1, taper=1:10)
> lines(lfit2[4], col=2)  # Nearly the same, until the last point

</s-example>
<s-example>
# A fit to the mulitple-infection data set of children with
# Chronic Granuomatous Disease.  See section 8.5 of Therneau and Grambsch.
> fita2 <- aareg(Surv(tstart, tstop, status) ~ rx + age + inherit +
                         steroids + cluster(id), data=cgd1)
> fit2a
  n= 203 
    69 out of 70 unique event times used

              slope      coef se(coef) robust se     z        p 
Intercept  0.012800  0.040600 0.021300  0.019600  2.08 0.037800
       rx -0.002520 -0.010100 0.002290  0.003020 -3.36 0.000787
      age -0.000101 -0.000317 0.000115  0.000117 -2.70 0.006840
  inherit  0.001330  0.003830 0.002800  0.002420  1.58 0.114000
 steroids -0.004620 -0.013200 0.010600  0.009700 -1.36 0.173000

Chisq=16.74 on 4 df, p=0.0022; test weights=aalen
</s-example>
</s-examples>
<s-keywords>
<s-keyword>
survival
</s-keyword>
</s-keywords>
<s-docclass>
function
</s-docclass>
</s-function-doc>
